<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ç®¡ç†è€…ï½œã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆç™»éŒ²</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: system-ui, sans-serif;
  padding:20px;
}
textarea {
  width:100%;
  height:200px;
}
button {
  margin-top:10px;
  padding:6px 12px;
}
</style>
</head>
<body>

<h1>ğŸ›  ç®¡ç†è€…ãƒšãƒ¼ã‚¸</h1>

<p>
ã‚¤ãƒ™ãƒ³ãƒˆåã‚’å…¥ã‚Œã‚‹ã¨ã€<br>
<strong>Wikipediaã‹ã‚‰é–¢é€£ãƒšãƒ¼ã‚¸ã‚’æ¢ã—ã€ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆå€™è£œã‚’è‡ªå‹•æŠ½å‡º</strong>ã—ã¾ã™ã€‚
</p>

<input id="event" placeholder="ä¾‹ï¼šãƒã‚¸ã‚«ãƒ«ãƒŸãƒ©ã‚¤2015">
<button onclick="fetchFromWikipedia()">è‡ªå‹•å–å¾—</button>

<div id="result"></div>

<script>
async function fetchFromWikipedia(){
  const e = document.getElementById("event").value;
  const r = document.getElementById("result");
  r.innerHTML="æ¤œç´¢ä¸­â€¦";

  const search =
    "https://ja.wikipedia.org/w/api.php" +
    "?action=query&list=search&srsearch=" +
    encodeURIComponent(e + " ã‚»ãƒƒãƒˆãƒªã‚¹ãƒˆ") +
    "&format=json&origin=*";

  const sres = await fetch(search).then(r=>r.json());
  if(!sres.query.search.length){
    r.innerHTML="è©²å½“ãƒšãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚";
    return;
  }

  const title = sres.query.search[0].title;

  const page =
    "https://ja.wikipedia.org/w/api.php" +
    "?action=parse&prop=wikitext&page=" +
    encodeURIComponent(title) +
    "&format=json&origin=*";

  const pres = await fetch(page).then(r=>r.json());
  const text = pres.parse.wikitext["*"];

  const songs = text.split("\n")
    .filter(l=>l.startsWith("*") || /^[0-9]/.test(l))
    .map(l=>l.replace(/[*0-9\.ï¼\[\]]/g,"").trim())
    .filter(l=>l.length>1);

  r.innerHTML =
    "<h3>å–å¾—å€™è£œï¼ˆç¢ºèªã—ã¦ã‚³ãƒ”ãƒšï¼‰</h3>" +
    "<textarea>" + [...new Set(songs)].join("\n") + "</textarea>";
}
</script>

</body>
</html>
